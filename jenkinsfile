pipeline {
agent {label 'built-in'}
stages {
  stage ("Checkout stage") {
    steps {
      git branch: 'master' , url: 'https://github.com/brad-jivedh/simple-java-maven-app.git'
    }
  }
stage ("Building the Docker image") {
  steps {
    script {
        withCredentials([string(credentialsId: 'sudo_password', variable: 'SUDO_PASS')]) {
        sh 'echo $SUDO_PASS | sudo -S docker build -t jivedh2019/assign:24 .'
    }
   }
  }
}
 stage("Pushing the image to DockerHub") {
            environment {
                DOCKER_CREDENTIALS=credentials('docker_hub')
            }
            steps {
                script {
                  sh 'docker login -u ${DOCKER_CREDENTIALS_USR} -p {DOCKER_CREDENTIALS_PSW}'
                  sh 'docker push jivedh/assign:${BUILD_NUMBER}'
                }
            }     
        }

}
}
